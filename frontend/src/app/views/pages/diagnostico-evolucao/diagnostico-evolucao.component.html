<div id="headerEmpresa" class="mb-0">
    <div class="mb-0 align-items-center d-flex justify-content-between flex-wrap">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb breadcrumb-arrow">
                <li class="breadcrumb-item">
                    <i class="feather icon-trending-up"></i>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    {{ 'EVOLUCAO.TITLE' | translate }}
                </li>
            </ol>
        </nav>
    </div>
</div>

<!-- Conteúdo principal -->
@if (!loading && !error && selectedEmpresaId && medias.length > 0) {
<!-- Tabela de Pilares com Médias -->
<div class="card mb-2">
    <div class="card-body">
        <div class="table-responsive" style="max-width: 80%; margin: 0 auto;">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>{{ 'PILARES.PILAR' | translate }}</th>
                        <th sortable="mediaAtual" (sort)="onSort($event)" class="text-center">{{ 'EVOLUCAO.MEDIA_ATUAL' | translate }}</th>
                    </tr>
                </thead>
                <tbody>
                    @for (media of getSortedMedias(); track media.pilarEmpresaId) {
                    <tr>
                        <td>{{ media.pilarNome }}</td>
                        <td class="text-center">
                            <app-media-badge [media]="media.mediaAtual" [justMedia]="true"></app-media-badge>
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Gráfico de Colunas por Data -->
<div class="card">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="card-title mb-0">{{ 'EVOLUCAO.GRAFICO_TITLE' | translate }}</h5>
            <!-- Botão Congelar -->
            @if (canCongelar) {
            <button type="button" class="btn btn-primary" ngbTooltip="{{('EVOLUCAO.CONGELAR_DESC' | translate)}}"
                (click)="congelarMedias()" [disabled]="medias.length === 0">
                <i class="feather icon-archive"></i>
                {{ 'EVOLUCAO.CONGELAR_BTN' | translate }}
            </button>
            }
        </div>
        <p class="text-muted small mb-3">
            <i class="feather icon-info me-1"></i>
            Cada pilar exibe suas médias congeladas ao longo do tempo
        </p>

        <div>
            <canvas id="evolucaoBarChart"></canvas>
        </div>

        @if (historico.length === 0) {
        <div class="empty-state" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
            <i class="feather icon-bar-chart-2"></i>
            <p>{{ 'EVOLUCAO.NO_HISTORICO' | translate }}</p>
        </div>
        }
    </div>
</div>
}

<!-- Loading -->
@else if (loading) {
<div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">{{ 'COMMON.LOADING' | translate }}...</span>
    </div>
</div>
}

<!-- Error -->
@else if (error && !loading) {
<ngb-alert type="danger" [dismissible]="false">
    <i class="feather icon-alert-circle"></i>
    {{ error }}
</ngb-alert>
}

<!-- Estado vazio -->
@else if (!loading && !error && medias.length === 0 && selectedEmpresaId) {
<div class="empty-state">
    <i class="feather icon-folder"></i>
    <p>{{ 'EVOLUCAO.NO_MEDIAS' | translate }}</p>
</div>
}

@else if (!loading && !error && !selectedEmpresaId && !isAdmin) {
<div class="empty-state">
    <i class="feather icon-alert-circle"></i>
    <p>{{ 'EVOLUCAO.NO_EMPRESA_ASSOCIATED' | translate }}</p>
</div>
}

@else if (!selectedEmpresaId && isAdmin) {
<div class="empty-state">
    <p>{{ 'EVOLUCAO.SELECT_EMPRESA_PLACEHOLDER' | translate }}</p>
</div>
}