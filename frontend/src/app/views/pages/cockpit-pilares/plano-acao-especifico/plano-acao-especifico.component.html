@if (loading) {
<div class="text-center py-4">
  <div class="spinner-border text-primary" role="status"></div>
  <p class="mt-2 text-muted">Carregando plano de ação...</p>
</div>
} @else {



<div class="kpi-sticky-container">
  <div class="row p-1 g-1 mb-2">
    <div class="plano-acao-header mt-2 px-3">
      <h5 class="card-title cockpit-tab-title text-uppercase small">
        <i class="bi bi-clipboard-check me-2"></i>
        RESUMO DO PLANO DE AÇÃO - {{ cockpit?.pilarEmpresa?.nome }}
      </h5>
    </div>
  @for (item of resumoStatus; track item.key) {
  <div class="col-6 col-md">
    <div class="card kpi-card" [ngClass]="item.kpiClass">
      <div class="card-body">
        <div class="kpi-header">
          <div class="kpi-icon" [ngClass]="item.kpiClass">
            <i class="feather" [ngClass]="'icon-' + item.icon"></i>
          </div>
          <span class="badge" [class]="item.badgeClass + ' text-black'">{{ item.label }}</span>
        </div>
        <div class="kpi-value">
          {{ item.count }} 
          <span class="kpi-percent-inline">{{ item.percent }}% do total</span>
        </div>
      </div>
    </div>
  </div>
  }
  </div>
</div>

<div class="card">
  <div class="card-body">

    <div class="cockpit-tab-header d-flex align-items-center justify-content-between flex-wrap plano-acao-header mb-3">
      <h5 class="card-title cockpit-tab-title">
        <i class="bi bi-clipboard-check me-2"></i>
        LISTA PLANO DE AÇÃO ESPECÍFICO
      </h5>
      <button type="button" class="btn btn-primary btn-sm btn-add-acao" (click)="abrirDrawerNovaAcao()">
        <i class="bi bi-plus-circle me-1"></i>
        Adicionar Ação
      </button>
    </div>

    @if (acoes.length === 0) {
    <div class="text-muted">Nenhuma ação encontrada.</div>
    } @else {
    <div class="table-responsive">
      <table class="table table-sm align-middle">
        <thead class="table-light small">
          <tr>
            <th style="width: 15%;">Indicador</th>
            <th style="width: 30%;" class="col-mobile-hide">Análise de Causas</th>
            <th style="width: 35%;" class="text-center col-mobile-hide">Ação Proposta</th>
            <th style="width: 10%;" class="text-center col-mobile-hide">Status</th>
            <th class="text-center" style="width: 5%;"></th>
          </tr>
        </thead>
        <tbody>
          @for (acao of acoes; track acao.id) {
          <tr>
            <td class="text-break" 
            style="word-break: break-word; white-space: normal; overflow-wrap: anywhere;">
              <span class="badge bg-gray-700 w-100 text-white"> <br><br>{{ acao.indicadorCockpit?.nome || '-' }}<br><br><br></span>
              <span class="badge bg-gray-100 w-100 text-black" style="font-weight: 400;">Mês da Análise:<br> {{ getMesLabel(acao.indicadorMensal) }}</span>
            </td>
            <td class="col-mobile-hide w-100 text-break">
              @if (acao.causa1) {
              <span class="badge bg-gray-100 text-black causa-badge mb-1" style="text-align: left;">Causa
                    1: 
                {{ acao.causa1 }}
              </span>
              }
              @if (acao.causa2) {
              <span class="badge bg-gray-100 text-black causa-badge mb-1" style="text-align: left;">Causa
                    2: 
                {{ acao.causa2 }}
              </span>
              }
              @if (acao.causa3) {
              <span class="badge bg-gray-100 text-black causa-badge mb-1" style="text-align: left;">Causa
                    3: 
                {{ acao.causa3 }}
              </span>
              }
              @if (acao.causa4) {
              <span class="badge bg-gray-100 text-black causa-badge mb-1" style="text-align: left;">Causa
                    4: 
                {{ acao.causa4 }}
              </span>
              }
              @if (acao.causa5) {
              <span class="badge bg-gray-100 text-black causa-badge mb-1" style="text-align: left;">Causa
                    5: 
                {{ acao.causa5 }}
              </span>
              }
            </td>
            <td class="col-mobile-hide">
              <span class="badge bg-gray-700 text-white acao-badge" style="text-align: left;">Ação:
                 <br><br>{{ acao.acaoProposta }}<br><br><br></span>
              <small>Responsável: {{ acao.responsavel?.nome || '-' }}</small><br>
            </td>
            <td class="text-center">
              <div>

                <div class="badge bg-gray-100 w-100 text-black" style="font-weight: 400; text-align: left;">
                  <small>Início Previsto: </small>{{ (acao.inicioPrevisto | date:'shortDate':'America/Sao_Paulo') ||
                  '-'}}
                </div>
<br>
                <div class="badge bg-gray-100 w-100 text-black" style="font-weight: 400; text-align: left;">
                  <small>Término Previsto: </small>{{ (acao.prazo | date:'shortDate':'America/Sao_Paulo') || '-'}}
                </div>

              </div>
              <span class="badge" [class]="getStatusClass(acao) + ' text-black'" style="width: 100%;">
                {{ getStatusLabel(acao) }}
              </span>

              <div>

                <div class="badge bg-gray-100 w-100 text-black" style="font-weight: 400; text-align: left;">
                  <small>Início Real: </small>{{ (acao.inicioReal | date:'shortDate':'America/Sao_Paulo') || '-'}}
                </div>
<br>
                <div class="badge bg-gray-100 w-100 text-black" style="font-weight: 400; text-align: left;">
                  <small>Término Real: </small> {{ (acao.dataConclusao | date:'shortDate':'America/Sao_Paulo') || '-'}}
                </div>

              </div>

            </td>
            <td class="text-end">
              <!-- @if (!acao.inicioReal) {
              <button class="btn btn-icon text-primary" (click)="marcarInicioReal(acao)" title="Marcar início real">
                <i class="feather icon-play"></i>
              </button>
              }
              @if (acao.inicioReal && !acao.dataConclusao) {
              <button class="btn btn-icon text-success" (click)="marcarTerminoReal(acao)" title="Marcar término real">
                <i class="feather icon-check"></i>
              </button>
              } -->
              <!-- <div ngbDropdown class="d-inline-block">
                <button class="btn btn-icon text-secondary" ngbDropdownToggle [title]="'BUTTONS.MORE' | translate">
                  <i class="feather icon-more-vertical"></i>
                </button>
                <div ngbDropdownMenu>
                  
                </div>
              </div> -->
              <button data-testid="edit-acao-button" class="btn btn-icon text-secondary"
                (click)="editarAcao(acao)" [title]="'BUTTONS.EDIT' | translate">
                <i class="feather icon-edit"></i>
              </button>
              <button data-testid="delete-acao-button" class="btn btn-icon text-danger"
                (click)="deleteAcao(acao)" [title]="'BUTTONS.DELETE' | translate">
                <i class="feather icon-trash-2"></i>
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    }
  </div>
</div>
}