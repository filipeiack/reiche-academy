<div class="container-fluid">
  <!-- Loading -->
  @if (loading) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Carregando...</span>
      </div>
      <p class="mt-3 text-muted">Carregando cockpit...</p>
    </div>
  }

  <!-- Error -->
  @if (error && !loading) {
    <div class="alert alert-danger" role="alert">
      <i class="bi bi-exclamation-triangle me-2"></i>
      {{ error }}
    </div>
  }

  <!-- Dashboard -->
  @if (cockpit && !loading && !error) {
    <div class="row">
      <div class="col-12">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="javascript:void(0)" (click)="voltar()">Diagnóstico</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
              {{ cockpit.pilarEmpresa?.nome || 'Cockpit' }}
            </li>
          </ol>
        </nav>

        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2>
            <i class="bi bi-speedometer2 me-2 text-primary"></i>
            Cockpit: {{ cockpit.pilarEmpresa?.nome }}
          </h2>
          <button class="btn btn-secondary" (click)="voltar()">
            <i class="bi bi-arrow-left me-1"></i>
            Voltar
          </button>
        </div>

        <!-- Tabs -->
        <ul class="nav nav-tabs mb-4" role="tablist">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              [class.active]="activeTab === 'contexto'"
              (click)="setActiveTab('contexto')"
              type="button"
            >
              <i class="bi bi-info-circle me-1"></i>
              Contexto
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              [class.active]="activeTab === 'indicadores'"
              (click)="setActiveTab('indicadores')"
              type="button"
            >
              <i class="bi bi-bar-chart me-1"></i>
              Indicadores
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              [class.active]="activeTab === 'graficos'"
              (click)="setActiveTab('graficos')"
              type="button"
            >
              <i class="bi bi-graph-up me-1"></i>
              Gráficos
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              [class.active]="activeTab === 'processos'"
              (click)="setActiveTab('processos')"
              type="button"
            >
              <i class="bi bi-list-check me-1"></i>
              Processos
            </button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Contexto -->
          @if (activeTab === 'contexto') {
            <div class="card">
              <div class="card-body">
                <h5 class="card-title mb-4">Contexto do Pilar</h5>

                <div class="mb-3">
                  <label class="form-label">Entradas</label>
                  <textarea
                    class="form-control"
                    [(ngModel)]="entradas"
                    rows="3"
                    placeholder="Ex: Pedidos de clientes, leads gerados, demandas de parceiros"
                  ></textarea>
                </div>

                <div class="mb-3">
                  <label class="form-label">Saídas</label>
                  <textarea
                    class="form-control"
                    [(ngModel)]="saidas"
                    rows="3"
                    placeholder="Ex: Propostas comerciais, contratos assinados, relatórios de vendas"
                  ></textarea>
                </div>

                <div class="mb-3">
                  <label class="form-label">Missão</label>
                  <textarea
                    class="form-control"
                    [(ngModel)]="missao"
                    rows="3"
                    placeholder="Ex: Garantir crescimento sustentável via canal indireto"
                  ></textarea>
                </div>

                <button
                  class="btn btn-primary"
                  (click)="saveContexto()"
                  [disabled]="savingContexto"
                >
                  @if (savingContexto) {
                    <span class="spinner-border spinner-border-sm me-1"></span>
                    Salvando...
                  } @else {
                    <i class="bi bi-save me-1"></i>
                    Salvar Contexto
                  }
                </button>
              </div>
            </div>
          }

          <!-- Indicadores -->
          @if (activeTab === 'indicadores') {
            <app-matriz-indicadores [cockpitId]="cockpit.id"></app-matriz-indicadores>
          }

          <!-- Gráficos -->
          @if (activeTab === 'graficos') {
            <app-grafico-indicadores [cockpitId]="cockpit.id"></app-grafico-indicadores>
          }

          <!-- Processos -->
          @if (activeTab === 'processos') {
            <app-matriz-processos [cockpitId]="cockpit.id"></app-matriz-processos>
          }
        </div>
      </div>
    </div>
  }
</div>
