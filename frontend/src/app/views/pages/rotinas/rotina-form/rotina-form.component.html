<div class="mb-2 align-items-center gap-2 d-flex justify-content-between flex-wrap">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb breadcrumb-arrow mb-1">
      <li class="breadcrumb-item">
        <i class="feather icon-repeat"></i>
      </li>
      <li class="breadcrumb-item">
        Rotinas
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        {{ isEditMode ? 'Editar' : 'Adicionar' }} Rotina
      </li>
    </ol>
  </nav>

  <!-- Buttons -->
  <div class="d-flex gap-2">
    <button type="button" data-testid="cancel-rotina-button" (click)="handleCancel()" class="btn btn-outline-secondary">
      {{ 'BUTTONS.CANCEL' | translate }}
    </button>
    <button type="submit" form="rotinaForm" data-testid="submit-rotina-button" class="btn btn-primary"
      [disabled]="loading || submitting || form.invalid">
      @if (loading || submitting) {
      <span class="spinner-border spinner-border-sm me-2" role="status"></span>
      } @if (isEditMode) {
      {{ "BUTTONS.UPDATE" | translate }}
      } @else {
      {{ "BUTTONS.CREATE" | translate }}
      }
    </button>

  </div>
</div>

<!-- Form -->
<div class="card-body">
  @if (loading && isEditMode) {
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">{{ 'COMMON.LOADING' | translate }}</span>
    </div>
  </div>
  } @else {
  <div class="row">
    <div class="col-md-8">
      <form id="rotinaForm" [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="card">
          <div class="card-body">

            <!-- Pilar -->
            <div class="mb-3">
              <label for="pilarId" class="form-label">
                Pilar <span class="text-danger">*</span>
              </label>
              <select #pilarIdSelect class="form-select" id="pilarId" formControlName="pilarId"
                [class.is-invalid]="pilarIdInvalid">
                <option value="">Selecione um pilar</option>
                <option *ngFor="let pilar of pilares" [value]="pilar.id">
                  {{ pilar.nome }}
                </option>
              </select>
              <div class="form-text" *ngIf="isEditMode">
                O pilar não pode ser alterado após a criação
              </div>
              <div class="invalid-feedback" *ngIf="pilarIdInvalid">
                Pilar é obrigatório
              </div>
            </div>

            <!-- Rotina -->
            <div class="mb-3">
              <label for="nome" class="form-label">
                Rotina <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control" id="nome" formControlName="nome" [class.is-invalid]="nomeInvalid"
                placeholder="Ex: Definir metas anuais">
              <div class="invalid-feedback" *ngIf="nomeInvalid">
                <span *ngIf="form.get('nome')?.errors?.['required']">
                  Rotina é obrigatória
                </span>
                <span *ngIf="form.get('nome')?.errors?.['minlength']">
                  Rotina deve ter no mínimo 3 caracteres
                </span>
                <span *ngIf="form.get('nome')?.errors?.['maxlength']">
                  Rotina deve ter no máximo 200 caracteres
                </span>
              </div>
            </div>


            <!-- Descrição -->
            <div class="mb-3">
              <label for="descricao" class="form-label">Explicação da Rotina</label>
              <textarea class="form-control" id="descricao" formControlName="descricao"
                [class.is-invalid]="descricaoInvalid" rows="4"
                placeholder="Descrição detalhada da rotina..."></textarea>
              <div class="form-text">
                Máximo 500 caracteres
              </div>
              <div class="invalid-feedback" *ngIf="descricaoInvalid">
                <span *ngIf="form.get('descricao')?.errors?.['maxlength']">
                  Explicação da Rotina deve ter no máximo 500 caracteres
                </span>
              </div>
            </div>

            <!-- Criticidade -->
            <div class="mb-3">
              <label for="criticidade" class="form-label">
                {{ 'DIAGNOSTICO.CRITICIDADE' | translate }}
              </label>
              <select class="form-select" id="criticidade" formControlName="criticidade">
                <option value="">{{ 'DIAGNOSTICO.SELECT_CRITICIDADE' | translate }}</option>
                <option *ngFor="let criticidade of criticidades" [value]="criticidade.value">
                  {{ criticidade.label }}
                </option>
              </select>
            </div>

          </div>
        </div>


        <div class="form-footer mt-4 d-flex justify-content-end gap-2">

        </div>
      </form>
    </div>


  </div>
  }
</div>